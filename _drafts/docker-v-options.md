# Docker -v 옵션의 의미

## `delegated`

`delegated` 설정은 보증하는 것이 가장 적다. `delegated`로 마운트한 디렉토리에 대해서는 컨테이너쪽 파일시스템 내용이 믿을만 하다. 그리고 컨테이너가 수행한 쓰기는 아마 호스트의 파일시스템에 즉시 반영되지 않을 것이다. NFS(Network File System) 비동기 모드 같은 상황에서, 만약 `delegated`로 마운트한 채로 실행한 컨테이너가 뻑나면, 기록이 유실될 수 있다.

그러나 일관성을 포기함으로써, `delegated` 마운트는 다른 설정에 비해 현저한 성능 향상을 제공한다. 임시 파일들의 공간이나 파일들을 빌드하는 곳처럼 작성된 데이터가 임시적인 곳이나 금세 재현가능한 곳에서 `delegated`는 아마도 올바른 선택일 것이다.

`delegated`는 컨테이너는 실행시에 다음 규약들을 보증한다. 

[아래 항목들은 엄밀한 번역을 해야 하는 듯해, must는 '반드시'로 직역하고, may는 문맥에 따라 번역한 뒤 괄호 안에 may를 표시했다. 파일시스템은 file system의 번역인데, '파일 시스템'으로 띄워서 번역하는 경우 파일과 시스템을 각각 인지할 위험이 있어 붙여 번역했다. 파일시스템은 FAT, FAT32, NTFS 등 하드디스크에 파일을 기록하는 체계를 의미한다. 아래 글에서 파일시스템이라는 용어가 사용된 이유는 도커에서 호스트의 파일시스템과 컨테이너의 파일시스템이 다른 경우 발생하는 문제를 해결하기 위해 사용하는 옵션을 다루고 있기 때문이다. 도커 컨테이너는 EXT4 파일시스템인데, 호스트는 NTFS나 APFS인 경우 말이다. - 역자]

1. 구현이 파일시스템 이벤트를 발생하면, 관련 파일시스템 상태와 연관해 컨테이너측 수정이 없는 경우, '해당 이벤트와 관련이 있는 컨테이너'의 상태는 '이벤트 발생 시점의 호스트 파일시스템 상태'를 *반드시* 반영해야 한다.

2. 플러시[^flush]나 동기화 작업이 수행되는 경우, 관련 데이터는 반드시 호스트 파일시스템에도 기록돼야 한다. 컨테이너는 기록된 데이터나 수정된 메타데이터, 바뀐 디렉토리 구조를 플러시하거나 동기화하기 전에 캐시해 둘 *수도(may)* 있다.

[^flush]: 아직 기록하지 않고 캐시만 해 둔 파일시스템 변경 내용을 기록하는 작업.

3. 동일한 실행시간에 모든 컨테이너는 *반드시* 마운트의 캐시를 일관되게 공유해야 한다.

4. `delegated`로 마운트한 볼륨을 공유하는 컨테이너가 종료되면, 마운트한 볼륨에서 일어난 변경사항은 호스트쪽 파일시스템에 *반드시* 기록돼야 한다.

5. `cached`나 `consistent` 마운트가 `delegated`로 마운트한 볼륨을 덮어써서 공유하는 경우, `delegated` 마운트는 `cached`나 `consistent` 마운트의 문법을 *반드시* 따라야 한다.

6. 컨테이너는 (디렉토리 구조, 노드의 존재 등을 포함해) 파일 데이터와 메타데이터를 무한정 붙잡고 있을 *수도(may)* 있다. 이 캐시가 호스트쪽 파일시스템 내용을 동기화하지 않게 만들 *수도(may)* 있다. 호스트쪽 파일시스템에 변경이 발생하면 구현자는 [이] 캐시를 만료시켜야 한다. 하지만 플랫폼의 한계로 인해 보장된 시간 안에 하는 것이 어려울 수도 있다.

7. 만약 마운트한 소스 디렉토리에 호스트 파일시스템 쪽의 변경사항이 존재하면, `delegated`로 마운트한 볼륨이 호스트쪽 소스 디렉토리와 동기화될 때 이 변경사항들은 유실될 *수도(may)* 있다.

8. 6-7번 동작은 소켓, 파이프나 디바이스 파일 유형에는 적용되지 *않는다*.


## `cached`

`cached` 설정은 `delegated`가 보장하는 것들을 모두 보장한다. 그리고 컨테이너가 수행한 기록이 나타나는 것에 관련해 추가로 몇 가지를 더 보장한다. 예를 들면, 보통 `cached`는 호스트와 컨테이너 사이의 일시적인 불일치를 감수하는 대신 읽기가 많은 작업의 성능을 개선한다.

`cached`로 마운트한 디렉토리에 대해, 호스트쪽 파일시스템의 내용이 믿을만 하다. 
