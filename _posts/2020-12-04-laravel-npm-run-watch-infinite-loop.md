---
title: '라라벨, npm run watch가 헛돌며 작동하지 않을 때'
layout: post
tags: 
  - PHP
  - Laravel
---

맥에서 라라벨 새 프로젝트를 만들고 `npm run watch`를 돌렸는데 작동하지 않았다. 커맨드라인에서는 컴파일이 끝나고 브라우저가 떴는데, 브라우저에 사이트가 나오지 않는 것이다. `localhost:3000`으로 접속하면 안 되고, 본래의 도메인(`video.localhost`)으로 접속하면 잘 됐다. 프록시 URL이 틀리게 들어간 것도 아니었다. 

`node_modules`을 지운 뒤 다시 설치도 해보고 nodejs 버전업도 해 보는 등 여러 삽질을 해도 안 됐다.

원인은 어이없게도 `/etc/hosts` 파일에 DNS 설정을 해 주지 않은 데 있었다. 이렇게 추가해 주니 잘 돌아갔다.

```
# (앞부분 생략)
127.0.0.1	video.localhost
```

기본을 잊지 말자.


## 자세한 설명 - `/etc/hosts`란 무엇인가

리눅스와 맥의 `/etc/hosts`는 도메인의 IP를 찾을 때 컴퓨터가 맨 처음 조사하는 파일이다(그러니깐 DNS 파일인 것이다). 윈도우는 이 파일이 `C:\Windows\System32\Drivers\etc\hosts` 경로에 있다.

`video.localhost`라는 도메인은 어디에도 없는 도메인이므로 컴퓨터가 찾지 못한다. 그래서 이 도메인은 `127.0.0.1` IP를 가리킨다고 `hosts` 파일에 써 줘야 하는 거다. 


## 자세한 설명 - `video.localhost` 도메인에 대한 설명

나는 로컬 개발시 도메인을 `localhost`의 서브도메인으로 만들어 사용한다. `localhost`는 자기 자신을 가리키는 도메인으로, 다른 어디에서도 사용하지 않는다. 그래서 로컬 개발용 도메인으로 사용하기에 안전하다.

아무도 사용하지 않는다는 것은 중요하다. 예컨대 `.dev` 도메인은 많은 개발자들이 로컬 개발용 주소로 사용하다가 정식 도메인으로 사용이 되기 시작했고, 구글이 크롬에서 `.dev` 도메인에 접속할 때 https를 강제하는 바람에 많은 개발자들이 하루아침에 멘붕에 빠진 적이 있다. 

함정에 빠졌던 이유는 `video.localhost`의 IP 주소를 hosts에 적어 주지 않아도 브라우저에서 접속이 됐기 때문이다. `video.localhost`는 `localhost` 도메인의 서브 도메인이다. `localhost`는 이미 `/etc/hosts` 파일에 주소가 매핑돼 있기 때문에 브라우저에서는 `localhost`의 서브 도메인 주소를 `127.0.0.1`로 해석해 낸다. (맥에선 그렇다. 리눅스는 기억이 가물하다.)

그런데 생각해 보니 `localhost`의 서브 도메인이 `localhost`와 동일한 IP를 사용한다고 보장할 수 없다. 브라우저에서 접속이 된다고 hosts 파일에 도메인 주소를 추가하지 않고 쓰다가 낭패를 본 것이다.
